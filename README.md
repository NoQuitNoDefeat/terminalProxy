# 🛠️ 各系统终端设置代理命令速查

以下命令用于在当前终端会话中临时设置代理。请注意，**关闭终端窗口后设置会失效**。
> **注意**：示例端口为 `10808`，请根据您实际使用的代理软件（如 Clash, V2Ray 等）修改端口号。通常 HTTP/HTTPS 端口为 7890, 10808, 10809 等。

---

## 1. Windows PowerShell
适用于 Windows 10/11 默认终端或 VS Code 终端。

```powershell
# 设置代理
$env:http_proxy="[http://127.0.0.1:10808](http://127.0.0.1:10808)"
$env:https_proxy="[http://127.0.0.1:10808](http://127.0.0.1:10808)"

# 验证设置（查看变量）
$env:http_proxy
$env:https_proxy

# 取消代理（清空变量）
$env:http_proxy=""
$env:https_proxy=""

# 💡 原理解析：环境变量如何作用于 Git

这是一个非常经典的网络配置场景，以下是关于 `$env:https_proxy` 如何协调 Git 与代理软件工作的详细解析。

---

## 1. 核心机制

您设置的 `$env:https_proxy` 环境变量是解决问题的关键，其原理主要包含以下三个部分：

### 🔍 环境变量的识别
* **自动检测：** 当您在终端中运行 `git clone`、`git pull` 或 `git push` 等命令时，Git 在尝试建立网络连接之前，会优先检查当前操作系统的环境变量。
* **关键词查找：** Git 会查找名为 `HTTP_PROXY` 或 `HTTPS_PROXY` 的变量（通常推荐使用小写 `http_proxy` 和 `https_proxy`）。
* **路由决策：** 一旦 Git 检测到 `https_proxy` 被设置为 `http://127.0.0.1:10808`，它就会知道：**所有对外的 HTTPS 连接都不能直接建立，必须强制通过这个指定的代理地址和端口。**

### 🛡️ 本地代理软件的作用
* **端口监听：** 您的代理软件（例如 Clash、V2ray 等）启动后，会在本地机器（`127.0.0.1`）上监听指定的端口（即您设置的 **10808**）。
* **中间人角色：** 代理软件充当了一个“本地中间人”，它负责接收来自应用程序（如 Git）的请求，并进行转发。

### 🔄 流量走向变化
连接过程不再是直接的 `Git -> GitHub`，而是变成了中转模式：

> **Git** $\rightarrow$ **本地代理软件 (10808)** $\rightarrow$ **GitHub 服务器**

---

## 2. 详细步骤拆解表

以下是数据包从您的电脑传输到 GitHub 的完整生命周期：

| 步骤 | 阶段 | 行为 | 说明 |
| :--- | :--- | :--- | :--- |
| **1** | **Git 准备** | Git 检查到 `https_proxy` 变量。 | Git 决定放弃直接连接 `github.com:443`，转而使用代理模式。 |
| **2** | **建立本地连接** | Git 向 `127.0.0.1:10808` 发送请求。 | Git 将所有请求打包，发送到本地代理软件监听的端口。 |
| **3** | **代理软件接收** | 您的代理软件捕获到请求。 | 代理软件根据内部规则（您配置的节点/线路），接管该数据包。 |
| **4** | **代理转发** | 代理软件将请求转发到 GitHub。 | 代理软件代替您的计算机，通过无阻碍的线路与 GitHub 服务器建立连接并传输数据。 |
| **5** | **数据返回** | 代理软件将结果回传给 Git。 | GitHub 响应后，代理软件通过本地 10808 端口将数据原路返回给等待中的 Git 进程。 |

---

## 📝 总结

简单来说，您设置的环境变量 `$env:https_proxy` 就像一张给 Git 的 **“特别通行证”**：

> **它告诉 Git：“不要自己直接去连服务器，把所有数据包都交给在 10808 端口等候的‘中介’（代理软件），让它来帮你完成发送和接收。”**

正是因为这个机制，您的 Git 流量成功绕过了可能存在的网络限制或防火墙。

---

### ✅ 下一步建议
现在您已经测试成功，**您是否需要我指导您如何将这个代理配置永久地写入 Git 全局配置中？** 这样您就不必每次打开终端都手动设置一遍环境变量了。
